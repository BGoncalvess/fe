name: CI/CD Pipeline

on:
  push:
    branches:
      - '**'
      
  pull_request:
    types: [opened, edited, synchronize, reopened]
    branches:
      - main

jobs:
  ci:
    runs-on: ubuntu-latest
    if: github.event_name == 'push'

    steps:
      - name: Checkout code
        run: echo "Checkout code"
      
      - name: Select MS
        run: echo "Select MS"
      
      - name: Code validations
        run: echo "Code validations"
      
      - name: Compile & run locally
        run: echo "Compile & run"
      
      - name: Unit tests
        run: echo "Unit tests"
      
      - name: Integration tests
        run: echo "Integration tests"
      
      - name: Cross integration tests
        run: echo "Cross integration tests"

      - name: Build images Dev, QA, Prod
        run: echo "Compile & run"

      - name: Push images to ACR
        run: echo "Push images to ACR"

      - name: Login Azure
        run: echo ""

      - name: Install kubeseal
        run: echo ""

      - name: Get cluster credentials
        run: |
          echo "github.event_name ${{ github.event_name }} github.base_ref: ${{ github.base_ref }}"



  cd:
    runs-on: ubuntu-latest
    needs: ci
    if: github.event_name == 'pull_request' && github.base_ref == 'main'

    steps:
      - name: Print Values
        run: |
         echo "github.event_name ${{ github.event_name }} github.base_ref: ${{ github.base_ref }}"

      - name: Clone IDP Repo
        run: echo ""

      - name: Create and push new branch
        run: echo "Create and push new branch"

      - name: Generate k8s manifests
        run: echo "Generate k8s manifests"
      
      - name: Create PR to IDP
        if: github.event.pull_request.merged == 'true'
        run: |
          echo "Create PR to IDP"
          echo "PR merged"